!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.PhotoSwipeUI_Default=b()}(this,function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this,x=document.getElementById("vp__my_modal"),y=!1,z=!0,A=!0,B=!0,C={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(a,b){return a.title?(b.children[0].innerHTML=a.title,!0):(b.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return a.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return a.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},D=function(a){if(s)return!0;a=a||window.event,r.timeToIdle&&r.mouseUsed&&!k&&T();for(var c,d,e=a.target||a.srcElement,f=e.getAttribute("class")||"",g=0;g<_.length;g++)c=_[g],c.onTap&&f.indexOf("pswp__"+c.name)>-1&&(c.onTap(),d=!0);if(d){a.stopPropagation&&a.stopPropagation(),s=!0;var h=b.features.isOldAndroid?600:30;t=setTimeout(function(){s=!1},h)}},E=function(){return!a.likelyTouchDevice||r.mouseUsed||screen.width>r.fitControlsWidth},F=function(a,c,d){b[(d?"add":"remove")+"Class"](a,"pswp__"+c)},G=function(){var a=1===r.getNumItemsFn();a!==q&&(F(d,"ui--one-slide",a),q=a)},H=function(){F(i,"share-modal--hidden",A)},I=function(){return console.log("toggle my modal hidden="+B),B="block"!=x.style.display,B?(console.log("show my modal v2"),setTimeout(function(){console.log("showing 30 ms later"),x.style.display="block"},30)):(console.log("hide my modal"),setTimeout(function(){console.log("hiding 30 ms later"),x.style.display="none"},30)),!1},J=function(){return A=!A,A?(b.removeClass(i,"pswp__share-modal--fade-in"),setTimeout(function(){if(A&&(console.log("Hide modal reload="+m),H(),m)){var b=!1,c="";console.log("Reloading..."),reloadPhotoswipe(g_pswp.cid,a.getCurrentIndex(),g_pswp.galleryElement,b,c)}},300)):(H(),setTimeout(function(){A||(console.log("Show modal reload="+m),b.addClass(i,"pswp__share-modal--fade-in"))},30)),!1},K=function(b){b=b||window.event;var c=b.target||b.srcElement;return a.shout("shareLinkClick",b,c),console.log("_openWindowPopup ",c),c.href?!!c.hasAttribute("download")||(console.log("ok, opening "+c.href),window.open(c.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),A||J(),!1):(console.log("no href.."),!1)},L=function(){var a="/login/",b=document.getElementById("vp__share-modal-content");b.innerHTML=vp_iframe(a)},M=function(){var a=document.getElementById("vp__share-modal-content");a.innerHTML=vp_container("Chat info comes here...","vp__chat_container")},N=function(){var a=document.getElementById("vp__share-modal-content");a.innerHTML=vp_container(vp_infocalendar(g_pswp.cid),"vp__calendar_container"),addtocalendar.load()},O=function(){var a=document.getElementById("vp__my-modal-content");a.innerHTML=vp_infotabs();var b=g_pswp.getCurrentData(g_pswp.cid)||{};vp_update_info(b);var c=document.getElementById("vp__tab1");c.click(),console.log("clicking tab1")},P=function(){var a=document.getElementById("vp__share-modal-content");a.innerHTML=vp_container(vp_infomap(g_pswp.vpdata),"vp__map_container");var b=g_pswp.getCurrentData(g_pswp.cid)||{},c=b.curator||{},d=c.location_lat,e=c.location_long,f=Math.abs(d)>0&&Math.abs(e)>0;f&&initModalMap("mapCanvas")},Q=function(){for(var a,b,c,d,e,f,g="",h=0;h<r.shareButtons.length;h++)a=r.shareButtons[h],c=r.getImageURLForShare(a),d=r.getPageURLForShare(a),e=r.getTextForShare(a),f=r.getObjIdForShare(a),b=a.url.replace("{{url}}",encodeURIComponent(d)).replace("{{image_url}}",encodeURIComponent(c)).replace("{{raw_image_url}}",c).replace("{{obj_id}}",f).replace("{{text}}",encodeURIComponent(e)),g+='<a href="'+b+'" target="_blank" class="pswp__share--'+a.id+'"'+(a.download?"download":"")+">"+a.label+"</a>",r.parseShareButtonOut&&(g=r.parseShareButtonOut(a,g));i.children[0].innerHTML='<div class="pswp__share-tooltip">'+g+"</div>",i.children[0].onclick=K},R=function(a){for(var c=0;c<r.closeElClasses.length;c++)if(b.hasClass(a,"pswp__"+r.closeElClasses[c]))return!0},S=0,T=function(){clearTimeout(v),S=0,k&&w.setIdle(!1)},U=function(a){a=a?a:window.event;var b=a.relatedTarget||a.toElement;b&&"HTML"!==b.nodeName||(clearTimeout(v),v=setTimeout(function(){w.setIdle(!0)},r.timeToIdleOutside))},V=function(){r.fullscreenEl&&!b.features.isOldAndroid&&(c||(c=w.getFullscreenAPI()),c?(b.bind(document,c.eventK,w.updateFullscreen),w.updateFullscreen(),b.addClass(a.template,"pswp--supports-fs")):b.removeClass(a.template,"pswp--supports-fs"))},W=function(){r.preloaderEl&&(X(!0),l("beforeChange",function(){clearTimeout(p),p=setTimeout(function(){a.currItem&&a.currItem.loading?(!a.allowProgressiveImg()||a.currItem.img&&!a.currItem.img.naturalWidth)&&X(!1):X(!0)},r.loadingIndicatorDelay)}),l("imageLoadComplete",function(b,c){a.currItem===c&&X(!0)}))},X=function(a){o!==a&&(F(n,"preloader--active",!a),o=a)},Y=function(a){var c=a.vGap;if(E()){var g=r.barsSize;if(r.captionEl&&"auto"===g.bottom)if(f||(f=b.createEl("pswp__caption pswp__caption--fake"),f.appendChild(b.createEl("pswp__caption__center")),d.insertBefore(f,e),b.addClass(d,"pswp__ui--fit")),r.addCaptionHTMLFn(a,f,!0)){var h=f.clientHeight;c.bottom=parseInt(h,10)||44}else c.bottom=g.top;else c.bottom="auto"===g.bottom?0:g.bottom;c.top=g.top}else c.top=c.bottom=0},Z=function(){r.timeToIdle&&l("mouseUsed",function(){b.bind(document,"mousemove",T),b.bind(document,"mouseout",U),u=setInterval(function(){S++,2===S&&w.setIdle(!0)},r.timeToIdle/2)})},$=function(){l("onVerticalDrag",function(a){z&&a<.95?w.hideControls():!z&&a>=.95&&w.showControls()});var a;l("onPinchClose",function(b){z&&b<.9?(w.hideControls(),a=!0):a&&!z&&b>.9&&w.showControls()}),l("zoomGestureEnded",function(){a=!1,a&&!z&&w.showControls()})},_=[{name:"caption",option:"captionEl",onInit:function(a){e=a}},{name:"share-modal",option:"shareEl",onInit:function(a){i=a},onTap:function(){J()}},{name:"button--share",option:"shareEl",onInit:function(a){h=a},onTap:function(){m=0,J(),Q()}},{name:"button--zoom",option:"zoomEl",onTap:a.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(a){g=a}},{name:"button--close",option:"closeEl",onTap:a.close},{name:"button--arrow--left",option:"arrowEl",onTap:a.prev},{name:"button--arrow--right",option:"arrowEl",onTap:a.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){var a=document.getElementById("vp__infoBtn");c.isFullscreen()?(c.exit(),a.style.display="block"):(a.style.display="none",c.enter())}},{name:"preloader",option:"preloaderEl",onInit:function(a){n=a}},{name:"button--like",option:"likeEl",onTap:function(){var a=g_pswp.getCurrentData(g_pswp.cid),b=a.item;if(m=0,g_pswp.reload=1,g_user_id)console.log("click on like by user "+g_user_id),g_pswp.like(g_pswp.cid,a);else{m=1;var c=vp_follow_link(a.curator_id,b);if(console.log("click on like - no user curator:"+a.curator_id+" mid="+b.media_id+" link="+c),!c)return;var d=document.getElementById("vp__share-modal-content");d.innerHTML=vp_iframe(c),J()}}},{name:"button--info",option:"infoEl",onInit:function(a){h=a},onTap:function(){m=0,console.log("infoEl tap"),I(),O()}},{name:"button--calendar",option:"calendarEl",onInit:function(a){h=a},onTap:function(){m=0,J(),N()}},{name:"button--user",option:"userEl",onInit:function(a){h=a},onTap:function(){m=1,J(),L()}},{name:"button--contact",option:"contactEl",onInit:function(a){h=a},onTap:function(){m=1;var a=vp_contact_link(g_pswp.cid);console.log("opening popup link="+a+" el:",h),vp_popup(a)}},{name:"button--map",option:"mapEl",onInit:function(a){h=a},onTap:function(){m=0,J(),P()}},{name:"button--chat",option:"chatEl",onInit:function(a){h=a},onTap:function(){m=0,J(),M()}}],aa=function(){var a,c,e,f=function(d){if(d)for(var f=d.length,g=0;g<f;g++){a=d[g],c=a.className;for(var h=0;h<_.length;h++)e=_[h],c.indexOf("pswp__"+e.name)>-1&&(r[e.option]?(b.removeClass(a,"pswp__element--disabled"),e.onInit&&e.onInit(a)):b.addClass(a,"pswp__element--disabled"))}};f(d.children);var g=b.getChildByClass(d,"pswp__top-bar");g&&f(g.children)};w.init=function(){b.extend(a.options,C,!0),r=a.options,d=b.getChildByClass(a.scrollWrap,"pswp__ui"),l=a.listen,$(),l("beforeChange",w.update),l("doubleTap",function(b){var c=a.currItem.initialZoomLevel;a.getZoomLevel()!==c?a.zoomTo(c,b,333):a.zoomTo(r.getDoubleTapZoom(!1,a.currItem),b,333)}),l("preventDragEvent",function(a,b,c){var d=a.target||a.srcElement;d&&d.getAttribute("class")&&a.type.indexOf("mouse")>-1&&(d.getAttribute("class").indexOf("__caption")>0||/(SMALL|STRONG|EM)/i.test(d.tagName))&&(c.prevent=!1)}),l("bindEvents",function(){b.bind(d,"pswpTap click",D),b.bind(a.scrollWrap,"pswpTap",w.onGlobalTap),a.likelyTouchDevice||b.bind(a.scrollWrap,"mouseover",w.onMouseOver)}),l("unbindEvents",function(){A||J(),u&&clearInterval(u),b.unbind(document,"mouseout",U),b.unbind(document,"mousemove",T),b.unbind(d,"pswpTap click",D),b.unbind(a.scrollWrap,"pswpTap",w.onGlobalTap),b.unbind(a.scrollWrap,"mouseover",w.onMouseOver),c&&(b.unbind(document,c.eventK,w.updateFullscreen),c.isFullscreen()&&(r.hideAnimationDuration=0,c.exit()),c=null)}),l("destroy",function(){r.captionEl&&(f&&d.removeChild(f),b.removeClass(e,"pswp__caption--empty")),i&&(i.children[0].onclick=null),b.removeClass(d,"pswp__ui--over-close"),b.addClass(d,"pswp__ui--hidden"),w.setIdle(!1)}),r.showAnimationDuration||b.removeClass(d,"pswp__ui--hidden"),l("initialZoomIn",function(){r.showAnimationDuration&&b.removeClass(d,"pswp__ui--hidden")}),l("initialZoomOut",function(){b.addClass(d,"pswp__ui--hidden")}),l("parseVerticalMargin",Y),aa(),r.shareEl&&h&&i&&(A=!0),G(),Z(),V(),W()},w.setIdle=function(a){k=a,F(d,"ui--idle",a)},w.update=function(){z&&a.currItem?(w.updateIndexIndicator(),r.captionEl&&(r.addCaptionHTMLFn(a.currItem,e),F(e,"caption--empty",!a.currItem.title)),y=!0):y=!1,A||J(),G()},w.updateFullscreen=function(d){d&&setTimeout(function(){a.setScrollOffset(0,b.getScrollY())},50),b[(c.isFullscreen()?"add":"remove")+"Class"](a.template,"pswp--fs")},w.updateIndexIndicator=function(){r.counterEl&&(g.innerHTML=a.getCurrentIndex()+1+r.indexIndicatorSep+r.getNumItemsFn())},w.onGlobalTap=function(c){c=c||window.event;var d=c.target||c.srcElement;if(console.log("tap target=",d),b.hasClass(d,"pswp__top-bar"))return void console.log("tap on top bar");if(!s)if(c.detail&&"mouse"===c.detail.pointerType){if(R(d))return void a.close();b.hasClass(d,"pswp__img")&&(1===a.getZoomLevel()&&a.getZoomLevel()<=a.currItem.fitRatio?r.clickToCloseNonZoomable&&a.close():a.toggleDesktopZoom(c.detail.releasePoint))}else if(r.tapToToggleControls&&(z?w.hideControls():w.showControls()),r.tapToClose&&(b.hasClass(d,"pswp__img")||R(d)))return void a.close()},w.onMouseOver=function(a){a=a||window.event;var b=a.target||a.srcElement;F(d,"ui--over-close",R(b))},w.hideControls=function(){b.addClass(d,"pswp__ui--hidden"),z=!1},w.showControls=function(){z=!0,y||w.update(),b.removeClass(d,"pswp__ui--hidden")},w.supportsFullscreen=function(){var a=document;return!!(a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen)},w.getFullscreenAPI=function(){var b,c=document.documentElement,d="fullscreenchange";return c.requestFullscreen?b={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:d}:c.mozRequestFullScreen?b={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+d}:c.webkitRequestFullscreen?b={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+d}:c.msRequestFullscreen&&(b={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),b&&(b.enter=function(){return j=r.closeOnScroll,r.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?a.template[this.enterK]():void a.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},b.exit=function(){return r.closeOnScroll=j,document[this.exitK]()},b.isFullscreen=function(){return document[this.elementK]}),b}};return a});